#!/usr/bin/env bash
set -o errexit
source config.sh

# The location of the java interpreter may be set explicitly with JAVA_EXE.
# Otherwise, JAVA_HOME is used.
# If JAVA_HOME is still undefined, simply use 'java'.
if [ -z "$JAVA_EXE" ]
then
  if [ -z "$JAVA_HOME" ]
  then
    JAVA_EXE="java"
  else
    JAVA_EXE="$JAVA_HOME/bin/java"
  fi
fi

# The installation directory containing configuration and dependencies may be set explicitly with INSTALL_DIR.
# Otherwise, an attempt is made to discover the location of this start script.

if [ -z "$INSTALL_DIR" ]
then
  DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
  INSTALL_DIR="$(dirname "$DIR")"
fi

if [ ! -d "$INSTALL_DIR/run" ]
then
  mkdir "$INSTALL_DIR/run"
fi

CLASSPATH="$INSTALL_DIR/target/${SERVER_NAME}-${VERSION}.jar"

DEP_LIB_DIR="$INSTALL_DIR/target/dependency"
for jar in $(ls $DEP_LIB_DIR/*.jar);
do
        CLASSPATH=$CLASSPATH:$jar
done

export CLASSPATH

if [ -f "$LOCAL_CONFIG" ]; then
  $JAVA_EXE -Dserver.install.dir="$INSTALL_DIR" $SERVER_CLASS $LOCAL_CONFIG
else
  $JAVA_EXE -Dserver.install.dir="$INSTALL_DIR" $SERVER_CLASS
fi